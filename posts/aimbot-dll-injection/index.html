<!doctype html><html lang=en-us>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Creating an aimbot with dll injection & hook function | </title>
<link rel=canonical href=https://onionpsy.github.io/posts/aimbot-dll-injection/>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Creating an aimbot with dll injection & hook function">
<meta property="og:description" content="An aimbot is a tool that automatically aim in shooter game. As a fun small little RE project, I wanted to try to create one for an old 2d shooter game called Soldat. I mostly used Cheat Engine for the debugging and DLL injection.
So, to aim at a character, we first need his position. by continuously scanning the memory with cheat engine, the memory space that contains the global coordinates of the npc is found relatively quickly:">
<meta property="og:type" content="article">
<meta property="og:url" content="https://onionpsy.github.io/posts/aimbot-dll-injection/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-03-16T18:31:25+01:00">
<meta property="article:modified_time" content="2022-03-16T18:31:25+01:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Creating an aimbot with dll injection & hook function">
<meta name=twitter:description content="An aimbot is a tool that automatically aim in shooter game. As a fun small little RE project, I wanted to try to create one for an old 2d shooter game called Soldat. I mostly used Cheat Engine for the debugging and DLL injection.
So, to aim at a character, we first need his position. by continuously scanning the memory with cheat engine, the memory space that contains the global coordinates of the npc is found relatively quickly:">
<link rel=stylesheet href=https://onionpsy.github.io/css/styles.4c2b9aa1d874d6766f554b2d404e8fd62ab4761f51ee9b3f358d12e81e7fa43a1b4378db995bc1926bbe5ed98c060be5e7bd4f2470504cf94f22b4b3a74e62b6.css integrity="sha512-TCuaodh01nZvVUstQE6P1iq0dh9R7ps/NY0S6B5/pDobQ3jbmVvBkmu+XtmMBgvl571PJHBQTPlPIrSzp05itg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://onionpsy.github.io/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&text=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&title=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&is_video=false&description=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function&body=Check out this article: https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&title=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&title=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&name=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function&description=An%20aimbot%20is%20a%20tool%20that%20automatically%20aim%20in%20shooter%20game.%20As%20a%20fun%20small%20little%20RE%20project%2c%20I%20wanted%20to%20try%20to%20create%20one%20for%20an%20old%202d%20shooter%20game%20called%20Soldat.%20I%20mostly%20used%20Cheat%20Engine%20for%20the%20debugging%20and%20DLL%20injection.%0aSo%2c%20to%20aim%20at%20a%20character%2c%20we%20first%20need%20his%20position.%20by%20continuously%20scanning%20the%20memory%20with%20cheat%20engine%2c%20the%20memory%20space%20that%20contains%20the%20global%20coordinates%20of%20the%20npc%20is%20found%20relatively%20quickly%3a" aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&t=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#dll-injection--hook-function>DLL injection & Hook function</a></li>
<li><a href=#patching--unpatching>Patching & Unpatching</a></li>
<li><a href=#hook-function>Hook function</a></li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Creating an aimbot with dll injection & hook function
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2022-03-16 18:31:25 +0100 +0100" itemprop=datePublished>2022-03-16</time>
</div>
</div>
</header>
<div class=article-gallery>
<a class=gallery-item href=/posts/aimbot-dll-injection/pointer_position.png rel=gallery_0>
<img src=/posts/aimbot-dll-injection/pointer_position.png itemprop=image>
</a>
<a class=gallery-item href=/posts/aimbot-dll-injection/result.gif rel=gallery_1>
<img src=/posts/aimbot-dll-injection/result.gif itemprop=image>
</a>
</div>
<div class=content itemprop=articleBody>
<p>An aimbot is a tool that automatically aim in shooter game. As a fun small little RE project, I wanted to try to create one for an old 2d shooter game called Soldat.
I mostly used Cheat Engine for the debugging and DLL injection.</p>
<p>So, to aim at a character, we first need his position.
by continuously scanning the memory with cheat engine, the memory space that contains the global coordinates of the npc is found relatively quickly:</p>
<pre tabindex=0><code>x: (2 byte, signed short) 0x0076AC08
y: (2 byte, signed short) 0x0076AC0C
</code></pre><p>As the shooting angle is determined by the mouse cursor, the second step is to find the coordinates of the pointer. This step is also relatively easy by watching which memory location is modified after moving the mouse:</p>
<pre tabindex=0><code>x: (4 bytes, float) 0x008DB298
y: (4 bytes, float) 0x008DB29A
</code></pre><p>by looking at which operators access these values, we can deduce which part of the code is executed when we fire with our character. This show us the function called when firing:</p>
<p><img src=pointer_position.png alt></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=color:#75715e>; (...)</span>
<span style=color:#75715e>; Pointer X:</span>
<span style=color:#a6e22e>fild</span> <span style=color:#66d9ef>word</span> ptr [ebx<span style=color:#f92672>+</span><span style=color:#ae81ff>0000B</span>FB8] <span style=color:#75715e>; convert signed int to float and push onto FPU</span>
<span style=color:#a6e22e>fstp</span> <span style=color:#66d9ef>dword</span> ptr [esp] <span style=color:#75715e>; push float on the stack. ptr on ESP</span>
<span style=color:#a6e22e>wait</span> 
<span style=color:#75715e>; Pointer Y:</span>
<span style=color:#a6e22e>fild</span> <span style=color:#66d9ef>word</span> ptr [ebx<span style=color:#f92672>+</span><span style=color:#ae81ff>0000B</span>FBA]
<span style=color:#a6e22e>fstp</span> <span style=color:#66d9ef>dword</span> ptr [esp<span style=color:#f92672>+</span><span style=color:#ae81ff>04</span>]
<span style=color:#a6e22e>wait</span> 
<span style=color:#75715e>; (...)</span>
<span style=color:#a6e22e>call</span> soldat.exe<span style=color:#f92672>+</span><span style=color:#ae81ff>82918</span> <span style=color:#75715e>; func to calculate the angle to the target</span>
<span style=color:#75715e>; (...)</span>
<span style=color:#a6e22e>call</span> soldat.exe<span style=color:#f92672>+</span><span style=color:#ae81ff>82974</span> <span style=color:#75715e>; actual fire function</span>
</code></pre></div><p>After debugging for a while, I decided to simply keep the same logic but change the values of the pointer right before <code>fild</code> is called.
Both pointer position and npc position were using global (world) coordinate so the only modification I had to make to the npc position was to cast it from <code>float</code> to <code>short</code>. To do that I used dll injection & hook function.</p>
<h2 id=dll-injection--hook-function>DLL injection & Hook function</h2>
<p>The objective here is to overwrite the values of the pointer by the values of the NPC before executing the rest of the function that takes care of the shooting. As the memory space in the function is limited, the most flexible way to achieve this is to create our own function that will be executed right before. This can easily be done by creating a x86 dll and injecting it with cheat engine, procexp or manually.</p>
<pre tabindex=0><code>  +------------------+   +---------+
-&gt;| Read pointer pos |--&gt;|  Shoot  |
  +------------------+   +---------+
</code></pre><pre tabindex=0><code>                                 +------------------+   +---------+
--&gt;+ (jmp)                       | Read pointer pos |--&gt;|  Shoot  |
   |                             +------------------+   +---------+
   |   +----------------------+    |
   +--&gt;| Read npc pos &amp; write |&gt;---+
       | to pointer pos       |
       +----------------------+
</code></pre><p>In this case, we will replace the first <code>fild</code> instruction by a jmp to our hook function as we don&rsquo;t want to overwrite the next instructions. <code>fild word ptr [ebx+0000BFB8]</code> is <code>DF 83 B8BF0000</code> so we need a jmp with the exact same number of bytes (6).</p>
<pre tabindex=0><code>&lt;jmp&gt;&lt;hook addr&gt;&lt;nop offset&gt; =&gt; 1 + 4 + 1 = 6 bytes
=&gt; 0xe9 &lt;???&gt; 0x90
</code></pre><p>To get the <code>Hook</code> function address, we can simply use the <code>GetProcAddress</code> windows function. One thing to notice is that <code>jmp</code> is always relative which mean we have to calculate the relative distance to the destination.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>DWORD hookAddr <span style=color:#f92672>=</span> (DWORD)GetProcAddress(dllHandle, <span style=color:#e6db74>&#34;Hook&#34;</span>);
DWORD dstAddr <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0059008D</span>; <span style=color:#75715e>// fild address
</span><span style=color:#75715e></span>DWORD offset <span style=color:#f92672>=</span> hookAddr <span style=color:#f92672>-</span> dstAddr <span style=color:#f92672>-</span> <span style=color:#ae81ff>5</span>; <span style=color:#75715e>// relative distance, 5 is the number of bytes used by jmp(1) + addr(4)
</span></code></pre></div><p>I created a simple struct to store patch and original code:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Patch</span> {
    vector<span style=color:#f92672>&lt;</span>BYTE<span style=color:#f92672>&gt;</span> originalPatch;
    vector<span style=color:#f92672>&lt;</span>BYTE<span style=color:#f92672>&gt;</span> newPatch;
};
</code></pre></div><h2 id=patching--unpatching>Patching & Unpatching</h2>
<p>If we want to directly write to memory, we first need to allow <code>read write</code> permission by using <code>VirtualProtect</code>. I created a custom function for that:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
<span style=color:#66d9ef>void</span> Write(DWORD addr, T value)
{
    DWORD oldprotect;
    VirtualProtect((<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>)addr, <span style=color:#66d9ef>sizeof</span>(T), PAGE_EXECUTE_READWRITE, <span style=color:#f92672>&amp;</span>oldprotect);
    <span style=color:#f92672>*</span>((T<span style=color:#f92672>*</span>)addr) <span style=color:#f92672>=</span> value;
    VirtualProtect((<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>)addr, <span style=color:#66d9ef>sizeof</span>(T), oldprotect, <span style=color:#f92672>&amp;</span>oldprotect);
}
</code></pre></div><p>I also created two functions to handle patching/unpatching if we simply want to apply or remove the change we did:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>HandlePatching</span>(<span style=color:#66d9ef>int</span> addr, Patch<span style=color:#f92672>&amp;</span> patch)
{
    <span style=color:#66d9ef>if</span> (patch.originalPatch.empty()) {
        BYTE bytes[<span style=color:#ae81ff>64</span>]; <span style=color:#75715e>// max patch size
</span><span style=color:#75715e></span>
        ReadProcessMemory(gameHandle, (<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>)addr, <span style=color:#f92672>&amp;</span>bytes, patch.newPatch.size(), <span style=color:#ae81ff>0</span>);
        patch.originalPatch <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>BYTE<span style=color:#f92672>&gt;</span>(std<span style=color:#f92672>::</span>begin(bytes), std<span style=color:#f92672>::</span>end(bytes));
        patch.originalPatch.resize(patch.newPatch.size());
    }

	<span style=color:#75715e>// write byte by byte
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> patch.newPatch.size(); i<span style=color:#f92672>++</span>) {
        Write<span style=color:#f92672>&lt;</span>BYTE<span style=color:#f92672>&gt;</span>((<span style=color:#66d9ef>int</span>)(addr <span style=color:#f92672>+</span> i), patch.newPatch[i]);
    }
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>HandleUnpatching</span>(<span style=color:#66d9ef>int</span> addr, Patch<span style=color:#f92672>&amp;</span> patch)
{
    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> patch.originalPatch.size(); i<span style=color:#f92672>++</span>) {
        Write<span style=color:#f92672>&lt;</span>BYTE<span style=color:#f92672>&gt;</span>((<span style=color:#66d9ef>int</span>)(addr <span style=color:#f92672>+</span> i), patch.originalPatch[i]);
    }
}
</code></pre></div><p>I then converted the instructions to my custom <code>Patch</code> struct. I also created a loop which allow us to activate/desactivate the patch by pressing <code>F4</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>// Main thread
</span><span style=color:#75715e></span>
BYTE byteArray[<span style=color:#66d9ef>sizeof</span>(DWORD)];
memcpy(byteArray, <span style=color:#f92672>&amp;</span>offset, <span style=color:#66d9ef>sizeof</span>(DWORD)); <span style=color:#75715e>// convert the offset to an array of BYTE
</span><span style=color:#75715e></span>Patch aimBot <span style=color:#f92672>=</span> Patch {
	vector<span style=color:#f92672>&lt;</span>BYTE<span style=color:#f92672>&gt;</span> {},
	vector<span style=color:#f92672>&lt;</span>BYTE<span style=color:#f92672>&gt;</span> {
		<span style=color:#ae81ff>0xe9</span>, byteArray[<span style=color:#ae81ff>0</span>], byteArray[<span style=color:#ae81ff>1</span>], byteArray[<span style=color:#ae81ff>2</span>], byteArray[<span style=color:#ae81ff>3</span>], <span style=color:#ae81ff>0x90</span> <span style=color:#75715e>// jmp &lt;offset&gt; nop
</span><span style=color:#75715e></span>	},
};

<span style=color:#66d9ef>bool</span> running <span style=color:#f92672>=</span> false;
<span style=color:#66d9ef>while</span> (true) {
	<span style=color:#66d9ef>if</span> (GetAsyncKeyState(VK_F4) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x80000</span>) {
		running <span style=color:#f92672>=</span> <span style=color:#f92672>!</span>running;
		<span style=color:#66d9ef>if</span> (running) {
			HandlePatching(dstAddr, aimBot);
			cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Hack activated&#34;</span> <span style=color:#f92672>&lt;&lt;</span> endl;
		} <span style=color:#66d9ef>else</span> {
			HandleUnpatching(dstAddr, aimBot);
			cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Hack desactived&#34;</span> <span style=color:#f92672>&lt;&lt;</span> endl;

		}
		Sleep(<span style=color:#ae81ff>200</span>);
	}
}

</code></pre></div><p>Pressing <code>F4</code> should change:</p>
<pre tabindex=0><code>DF 83 B8BF0000        - fild word ptr [ebx+0000BFB8]
</code></pre><p>to</p>
<pre tabindex=0><code>E9 DE126078           - jmp SoldatDLL.Hook
90                    - nop
</code></pre><h2 id=hook-function>Hook function</h2>
<p>First we need struct to store the npc and pointer position addresses we found earlier:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>AddrPosition</span> {
    DWORD x;
    DWORD y;
};

AddrPosition npc1Position <span style=color:#f92672>=</span> {
    <span style=color:#ae81ff>0x0076AC08</span>,
    <span style=color:#ae81ff>0x0076AC0C</span>
};

AddrPosition pointerPosition <span style=color:#f92672>=</span> {
    <span style=color:#ae81ff>0x008DB298</span>,
    <span style=color:#ae81ff>0x008DB29A</span>,
};

<span style=color:#66d9ef>extern</span> <span style=color:#e6db74>&#34;C&#34;</span> DWORD retAddr;
</code></pre></div><p>One thing to notice is to avoid an infinite loop, we need to tell where to continue after our hook function is finished. To do that, we just add our patch offset size to the original target address.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>retAddr <span style=color:#f92672>=</span> dstAddr <span style=color:#f92672>+</span> aimBot.newPatch.size(); <span style=color:#75715e>// 0x0059008D + 5 = 0x00590092
</span></code></pre></div><p>For the actual hook function, two attributes are needed:</p>
<ul>
<li><code>naked</code> allow us to skip the stack frame creation and change return address</li>
<li><code>dllexport</code> make it visible for the main process</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>extern</span> <span style=color:#e6db74>&#34;C&#34;</span> _declspec(<span style=color:#66d9ef>naked</span>, dllexport)
<span style=color:#66d9ef>void</span> Hook() <span style=color:#66d9ef>noexcept</span>
{
    <span style=color:#66d9ef>__asm</span>
    {
        pushad <span style=color:#75715e>// save all general registers
</span><span style=color:#75715e></span>    }

	<span style=color:#75715e>// cast npc position (float) to short int and
</span><span style=color:#75715e></span>	<span style=color:#75715e>// write the result in 0x008DB298 &amp; 0x008DB29A
</span><span style=color:#75715e></span>    Write<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>short</span><span style=color:#f92672>&gt;</span>(pointerPosition.x, (<span style=color:#66d9ef>short</span>) <span style=color:#f92672>*</span>(<span style=color:#66d9ef>float</span><span style=color:#f92672>*</span>)npc1Position.x);
    Write<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>short</span><span style=color:#f92672>&gt;</span>(pointerPosition.y, (<span style=color:#66d9ef>short</span>) <span style=color:#f92672>*</span>(<span style=color:#66d9ef>float</span><span style=color:#f92672>*</span>)npc1Position.y <span style=color:#f92672>-</span> <span style=color:#ae81ff>10</span>);

    <span style=color:#66d9ef>__asm</span>
    {
        popad <span style=color:#75715e>// restore registers
</span><span style=color:#75715e></span>        fild word ptr[ebx <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x0000BFB8</span>] <span style=color:#75715e>// restore the instruction we overwrote with our JMP
</span><span style=color:#75715e></span>        push retAddr <span style=color:#75715e>// push the new ret address
</span><span style=color:#75715e></span>        ret <span style=color:#75715e>// =&gt; fstp dword ptr [esp]
</span><span style=color:#75715e></span>    }
}
</code></pre></div><p>As the origin is at the bottom of its hitbox, we need to add a small offset to center the shots. Our pointer position is now quickly moved to the center of the npc position each time we shoot:</p>
<p><img src=result.gif alt></p>
<p>The aimbot is extremely simple and does not take into account bullet drop or even multiple npc. Perhaps I&rsquo;ll do a second chapter once.</p>
<p><em>PS: This little exercise is for educational purposes only and will not work online anyway as the DLL injection is detected by the anti cheat system so no need to try. :></em></p>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#dll-injection--hook-function>DLL injection & Hook function</a></li>
<li><a href=#patching--unpatching>Patching & Unpatching</a></li>
<li><a href=#hook-function>Hook function</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&text=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&title=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&is_video=false&description=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function&body=Check out this article: https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&title=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&title=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&name=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function&description=An%20aimbot%20is%20a%20tool%20that%20automatically%20aim%20in%20shooter%20game.%20As%20a%20fun%20small%20little%20RE%20project%2c%20I%20wanted%20to%20try%20to%20create%20one%20for%20an%20old%202d%20shooter%20game%20called%20Soldat.%20I%20mostly%20used%20Cheat%20Engine%20for%20the%20debugging%20and%20DLL%20injection.%0aSo%2c%20to%20aim%20at%20a%20character%2c%20we%20first%20need%20his%20position.%20by%20continuously%20scanning%20the%20memory%20with%20cheat%20engine%2c%20the%20memory%20space%20that%20contains%20the%20global%20coordinates%20of%20the%20npc%20is%20found%20relatively%20quickly%3a" aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fonionpsy.github.io%2fposts%2faimbot-dll-injection%2f&t=Creating%20an%20aimbot%20with%20dll%20injection%20%26%20hook%20function" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2022
</div>
<div class=footer-right>
<nav>
<ul>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>